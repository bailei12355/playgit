!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(){var e=n(this),a=o.settings;return isNaN(e.datetime)||(0==a.cutoff||Math.abs(i(e.datetime))<a.cutoff)&&t(this).text(r(e.datetime)),this}function n(e){if(e=t(e),!e.data("timeago")){e.data("timeago",{datetime:o.datetime(e)});var n=t.trim(e.text());o.settings.localeTitle?e.attr("title",e.data("timeago").datetime.toLocaleString()):!(n.length>0)||o.isTime(e)&&e.attr("title")||e.attr("title",n)}return e.data("timeago")}function r(t){return o.inWords(i(t))}function i(t){return(new Date).getTime()-t.getTime()}t.timeago=function(e){return r(e instanceof Date?e:"string"==typeof e?t.timeago.parse(e):"number"==typeof e?new Date(e):t.timeago.datetime(e))};var o=t.timeago;t.extend(t.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(e){function n(n,i){var o=t.isFunction(n)?n(i,e):n,a=r.numbers&&r.numbers[i]||i;return o.replace(/%d/i,a)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var r=this.settings.strings,i=r.prefixAgo,o=r.suffixAgo;if(this.settings.allowFuture&&0>e&&(i=r.prefixFromNow,o=r.suffixFromNow),!this.settings.allowPast&&e>=0)return this.settings.strings.inPast;var a=Math.abs(e)/1e3,s=a/60,u=s/60,l=u/24,c=l/365,d=45>a&&n(r.seconds,Math.round(a))||90>a&&n(r.minute,1)||45>s&&n(r.minutes,Math.round(s))||90>s&&n(r.hour,1)||24>u&&n(r.hours,Math.round(u))||42>u&&n(r.day,1)||30>l&&n(r.days,Math.round(l))||45>l&&n(r.month,1)||365>l&&n(r.months,Math.round(l/30))||1.5>c&&n(r.year,1)||n(r.years,Math.round(c)),f=r.wordSeparator||"";return void 0===r.wordSeparator&&(f=" "),t.trim([i,d,o].join(f))},parse:function(e){var n=t.trim(e);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(e){var n=t(e).attr(o.isTime(e)?"datetime":"title");return o.parse(n)},isTime:function(e){return"time"===t(e).get(0).tagName.toLowerCase()}});var a={init:function(){var n=t.proxy(e,this);n();var r=o.settings;r.refreshMillis>0&&(this._timeagoInterval=setInterval(n,r.refreshMillis))},update:function(n){var r=o.parse(n);t(this).data("timeago",{datetime:r}),o.settings.localeTitle&&t(this).attr("title",r.toLocaleString()),e.apply(this)},updateFromDOM:function(){t(this).data("timeago",{datetime:o.parse(t(this).attr(o.isTime(this)?"datetime":"title"))}),e.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};t.fn.timeago=function(t,e){var n=t?a[t]:a.init;if(!n)throw new Error("Unknown function name '"+t+"' for timeago");return this.each(function(){n.call(this,e)}),this},document.createElement("abbr"),document.createElement("time")}),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;Maleskine.List=function(n){function r(){this.loadOrigins=t(this.loadOrigins,this),this.initSharedAt=t(this.initSharedAt,this),r.__super__.constructor.apply(this,arguments),$.timeago.settings.strings=I18n.t("jquery-timeago"),this.initSharedAt(),this.initFollowingState(),this.loadOrigins(),this.el.find("p.list-top").on("ajax:success","a",function(t){return function(e){return $(e.currentTarget).closest("span").tooltip("destroy"),setTimeout(function(){return t.initTooltip()},20)}}(this)),$("div.list-footer i[data-toggle='tooltip']").tooltip()}return e(r,n),r.prototype.initFollowingState=function(){return $("body").on("mouseenter","p.list-top span.following",function(){return $(this).find("a").html("<i class='fa fa-fw fa-times'></i><span>"+I18n.t("reading.unfollow")+"</span>")}),$("body").on("mouseleave","p.list-top span.following",function(){return $(this).find("a").html("<i class='fa fa-fw fa-check'></i><span>"+I18n.t("reading.following")+"</span>")})},r.prototype.initSharedAt=function(){return $.each($("p.list-top span.time"),function(){return $(this).html($.timeago(new Date($(this).data("sharedAt"))))}),this.initTooltip()},r.prototype.initTooltip=function(){return $("p.list-top span.btn-success.follow").tooltip({title:function(){return I18n.t("reading.notes.list.follow",{nickname:$(this).closest("span").prev().text()})}})},r.prototype.loadOrigins=function(){return this.el.find("div.list-footer [data-note-id]").on("click",function(){return $(this).closest("div").hasClass("open")?void 0:$.ajax({method:"get",dataType:"html",url:$(this).data("url"),success:function(t){return function(e){return $(t).next().find("ul").html(e)}}(this)})})},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;Maleskine.UserShow=function(n){function r(){this.startEditIntro=t(this.startEditIntro,this),this.cancelEditIntro=t(this.cancelEditIntro,this);var e;r.__super__.constructor.apply(this,arguments),e=new Maleskine.List({el:this.el}),this.introForm.on("ajax:success",function(t){return function(e,n){var r;return r=n.user,t.intro.html(r.intro_compiled),t.name.text(r.nickname),t.errorMessage.hide(),t.cancelEditIntro()}}(this)),this.introForm.on("ajax:error",function(t){return function(e,n){return t.errorMessage.html($.parseJSON(n.responseText).errors[0]),t.errorMessage.fadeIn("fast")}}(this)),this.initFollowingState(),this.infiniteScroll(),this.recommendUser.length>0&&this.recommendUser.on("ajax:success",function(t){return function(e,n){return t.recommendUser.find("span").html(n["is_recommended?"]?"Unrecommend":"Recommend")}}(this)),this.el.pjax("a[data-pjax]","#list-container"),$("#list-container").on("pjax:success",function(){return function(t){var n;return $("ul.nav-relationships li").removeClass("active"),n=$(t.relatedTarget),n.parent().addClass("active"),$(window).scroll(),e.initSharedAt()}}(this)),$("#list-container").on("pjax:success",function(){return function(t){var n;return $("ul.nav-articles li").removeClass("active"),n=$(t.relatedTarget),n.parent().addClass("active"),$(window).scroll(),e.initSharedAt()}}(this))}return e(r,n),r.prototype.elements={".edit-intro":"editIntro",".intro-form":"introForm",".intro":"intro","div.basic-info h3 > a":"name","#recommend-user":"recommendUser",".form-error-message":"errorMessage"},r.prototype.events={"click .cancel":"cancelEditIntro","click .edit-intro":"startEditIntro"},r.prototype.toggleCommentsDisplay=function(t){var e,n,r,i,o;return n=$(t.target),i=n.data("comments-id"),e=$("#"+i),r=e.find("input[type=text]"),r.data("atwho")||(r.atwho({at:":",limit:10,tpl:"<li data-value='${name}:'><img src='"+Maleskine.Settings.emoji_host+"/assets/emojis/${name}.png' height='20' width='20'/> ${name} </li>",data:Maleskine.Emoji}),r.data("atwho",!0)),o=e.is(":hidden")?(Maleskine.Timeline.paginate(i,1),n.data("original-text",n.html()),I18n.t("reading.timeline.collapse_comments")):n.data("original-text"),e.toggle("fast"),n.text(o)},r.prototype.initFollowingState=function(){return $("body").on("mouseenter",".following a",function(){return $(this).html("<i class='fa fa-times'></i>"+I18n.t("reading.unfollow"))}),$("body").on("mouseleave",".following a",function(){return $(this).html("<i class='fa fa-check'></i>"+I18n.t("reading.following"))})},r.prototype.cancelEditIntro=function(){return this.introForm.hide(),this.name.show(),this.editIntro.show(),this.intro.show()},r.prototype.startEditIntro=function(){return this.introForm.show(),this.name.hide(),this.editIntro.hide(),this.intro.hide()},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Maleskine.Report=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.el.find("a[data-toggle='modal']").on("click",function(){return function(t){return $("#report-form").attr("action",$(t.currentTarget).data("url"))}}(this)),this.el.on("ajax:beforeSend","a[data-type]",function(t){return function(){return confirm(I18n.t("reading.abuse_report.confirm"))?void 0:(t.el.removeClass("open"),!1)}}(this)),this.el.on("ajax:success","a[data-type]",function(t){return function(){return t.el.removeClass("open"),t.notyInfo(I18n.t("reading.abuse_report.report_success"))}}(this)),this.el.on("ajax:error","a[data-type]",function(t){return function(e,n){return t.el.removeClass("open"),t.notyError(n.responseJSON.error[0])}}(this))}return t(n,e),n}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},e={}.hasOwnProperty;Maleskine.ReportModal=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.el.on("hide.bs.modal",function(t){return function(){return t.reportForm.find("textarea").val(""),t.reportForm.find("#abuse_report_abuse_reportable_id").val(""),t.reportForm.find("#abuse_report_abuse_reportable_type").val("")}}(this)),this.el.on("ajax:beforeSend","form",function(t){return function(){return t.el.find("textarea").val().length<=0?(t.notyError(I18n.t("reading.abuse_report.no_reason")),!1):void 0}}(this)),this.el.on("ajax:error","form",function(t){return function(e,n){return t.el.modal("hide"),t.notyError(n.responseJSON.error[0])}}(this)),this.el.on("ajax:success","form",function(t){return function(){return t.el.modal("hide"),t.notyInfo(I18n.t("reading.abuse_report.report_success"))}}(this))}return t(n,e),n.prototype.elements={"#report-form":"reportForm"},n}(Maleskine.BaseModule)}.call(this);